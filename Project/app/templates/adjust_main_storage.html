<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Adjust Main Storage</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            // Fetch main storage quantity
            function getMainStorageQuantity() {
                $.get('/get_main_storage_quantity', function(data) {
                    $('#main-storage-quantity').text('Main Storage Quantity: ' + data.quantity);
                }).fail(function(response) {
                    alert('Failed to fetch main storage quantity. ' + response.responseText);
                });
            }

            // Fetch entities by type
            function getEntitiesByType(entityType) {
                $.get('/get_entities_by_type', {type: entityType}, function(data) {
                    var $list = $('#entity-list').empty();
                    data.forEach(function(entity) {
                        $list.append($('<li>').text(entity.name + ' - Quantity: ' + entity.quantity));
                    });
                }).fail(function(response) {
                    alert('Failed to fetch entities. ' + response.responseText);
                });
            }

            // Adjust main storage quantity
            $('#adjust-main-storage-form').submit(function(event) {
                event.preventDefault();
                var formData = $(this).serialize();
                $.post('/adjust_main_storage', formData, function(response) {
                    alert(response.message);
                    getMainStorageQuantity();
                }).fail(function(response) {
                    alert('Error: ' + response.responseText);
                });
            });

            // Button click handlers
            $('#show-storages').click(function() {
                getEntitiesByType('storage');
            });
            $('#show-partners').click(function() {
                getEntitiesByType('partner');
            });

            // Initial call to populate main storage quantity
            getMainStorageQuantity();
        });

     
    
 </script>
 
 <script>
   $(document).ready(function() {
  // Function to update storage, parameter 'operation' can be 'add' or 'subtract'
  function adjustStorage(operation) {
    var partnerName = $('#partner-select').val();
    var quantity = parseInt($('#quantity').val(), 10);

    // Validate input
    if (!partnerName) {
      alert('Please select a partner.');
      return;
    }
    if (isNaN(quantity) || quantity <= 0) {
      alert('Please enter a valid quantity.');
      return;
    }

    // AJAX request to the server
    $.ajax({
      url: '/adjust_main_storage',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        partner_name: partnerName,
        quantity: quantity,
        operation: operation // 'add' or 'subtract'
      }),
      dataType: 'json',
      success: function(response) {
        alert(response.message + ' New Quantity: ' + response.new_quantity);
        // Optionally, update the UI here with the new quantity
      },
      error: function(xhr) {
        alert('Error: ' + xhr.responseJSON.error);
      }
    });
  }

  // Event listeners for the buttons
  $('#add-storage-btn').click(function() {
    adjustStorage('add');
  });

  $('#subtract-storage-btn').click(function() {
    adjustStorage('subtract');
  });
});



 </script>



 </head>
 <body>
    <h1>Adjust Main Storage</h1>
    <div id="main-storage-quantity"></div>
    <button id="show-storages">Show Small Storages</button>
    <button id="show-partners">Show Partners</button>
    <div id="entity-container">
        <h2>Entities List</h2>
        <ul id="entity-list"></ul>
    </div>
   <!-- Dropdown for selecting the partner -->
<select id="partner-select">
  <option value="">Select a Partner</option>
  <!-- Dynamically filled options will go here -->
</select>

<!-- Input for specifying the quantity -->
<input type="number" id="quantity" placeholder="Enter Quantity" />

<!-- Buttons for triggering the storage adjustment -->
<button id="add-storage-btn">Add to Storage</button>
<button id="subtract-storage-btn">Subtract from Storage</button>


    
 </body>
 </html>

 


