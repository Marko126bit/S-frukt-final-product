<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Adjust Main Storage</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
       $(document).ready(function() {
  // Fetch and populate partners when "Show Partners" button is clicked
  $('#show-partners').click(function() {
    $.get('/get_entities_by_type', { type: 'partner' }, function(data) {
      $('#partner-select').empty().append('<option value="">Select a Partner</option>');
      data.forEach(function(partner) {
        $('#partner-select').append(new Option(partner.name, partner.name));
      });
    }).fail(function(error) {
      alert('Failed to fetch partners: ' + error.responseJSON.error);
    });
  });

  

  // Adjust the main storage when "Add to Storage" or "Subtract from Storage" button is clicked
  function adjustMainStorage(operation) {
  var partnerId = $('#partner-select').val(); // This should be the partner's ID, not name
  var quantity = parseInt($('#quantity').val(), 10);

  if (!partnerId || isNaN(quantity) || quantity <= 0) {
    alert('Please select a partner and enter a valid quantity.');
    return;
  }

  // AJAX request to adjust main storage
  $.ajax({
    url: '/adjust_main_storage', // Make sure this matches your Flask app's URL
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify({ partner_id: partnerId, quantity: quantity, operation: operation }),
    dataType: 'json',
    success: function(response) {
  alert(response.message + '. New Main Storage Quantity: ' + response.new_main_storage_quantity + '. New Partner Quantity: ' + response.new_partner_quantity);
},

    error: function(xhr) {
      alert('Error adjusting main storage: ' + xhr.responseJSON.error);
    }
  });
}



// Attach event handlers for the adjust storage buttons
$('#add-storage-btn').click(function() { adjustMainStorage('add'); });
$('#subtract-storage-btn').click(function() { adjustMainStorage('subtract'); });
});


function fetchAndPopulatePartners() {
        $.ajax({
            url: '/get_partners',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                var $partnerSelect = $('#partner-select');
                $partnerSelect.empty().append($('<option>').val('').text('Select a Partner'));

                // Loop through each partner and append an option to the select
                $.each(data, function(index, partner) {
                    $partnerSelect.append($('<option>').val(partner.id).text(partner.name));
                });
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert('Failed to fetch partners: ' + errorThrown);
            }
        });
    }

    // Initial call to populate partners on page load
    fetchAndPopulatePartners();
    
    // Rest of your event handlers and functions

  $(document).ready(function() {
    // Fetch and display the main storage and partners quantities when the page loads
    $.getJSON('/get_quantities', function(data) {
        $('#main-storage-quantity').text(data.main_storage_quantity);

        var partnersHtml = data.partners.map(function(partner) {
            return '<p>' + partner.name + ' Quantity: ' + partner.quantity + '</p>';
        }).join('');

        $('#partners-info').html(partnersHtml);
    }).fail(function(response) {
        alert('Failed to fetch quantities: ' + response.responseJSON.error);
    });
  });

  function returnAllToMainStorage() {
  $.ajax({
    url: '/return_all_to_main',  // The URL for the route
    type: 'POST',
    contentType: 'application/json',
    success: function(response) {
      // Handle success
      alert(response.success + '. New Main Storage Quantity: ' + response.new_main_storage_quantity);
      // You might want to update your page's UI here to reflect the new main storage quantity
      $('#main-storage-quantity').text(response.new_main_storage_quantity);
      // Assuming you have a span or div with id 'main-storage-quantity' to display the main storage quantity
    },
    error: function(xhr, status, error) {
      // Handle error
      alert('Error: ' + xhr.responseJSON.error);
    }
  });
}

// You might want to call this function when a button is clicked:
$('#return-all-to-main-btn').click(returnAllToMainStorage);
</script>



 </script>



 </head>
 <body>
    <h1>Adjust Main Storage</h1>
    <select id="partner-select">
      <!-- Options will be populated by JavaScript -->
    </select>
    
    <input type="number" id="quantity" placeholder="Enter Quantity" />
    
    <button id="add-storage-btn">Add to Storage</button>
    <button id="subtract-storage-btn">Subtract from Storage</button>
    <button id="return-to-partners-btn">Return to Partners</button>


    
    <a href="{{ url_for('home') }}">Back to Home</a>
   
    <div id="storage-info">
      <h3>Main Storage Quantity: <span id="main-storage-quantity">Loading...</span></h3>
    </div>
    <div id="partners-info">
      <!-- Partners' quantities will be populated here -->
    </div>
    
 </body>
 </html>

 


